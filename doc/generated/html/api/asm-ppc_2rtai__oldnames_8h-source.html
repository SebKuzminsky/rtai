<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RTAI API: base/include/asm-ppc/rtai_oldnames.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<div class="nav">
<a class="el" href="dir_000000.html">base</a>&nbsp;/&nbsp;<a class="el" href="dir_000015.html">include</a>&nbsp;/&nbsp;<a class="el" href="dir_000021.html">asm-ppc</a></div>
<h1>rtai_oldnames.h</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment"> *   ARTI -- RTAI-compatible Adeos-based Real-Time Interface. Based on</span>
00003 <span class="comment"> *   the original RTAI layer for PPC and the RTAI/x86 rewrite over ADEOS.</span>
00004 <span class="comment"> *   This file provides user-visible definitions for compatibility purpose </span>
00005 <span class="comment"> *   with the legacy RTHAL. Must be included from rtai_hal.h only.</span>
00006 <span class="comment"> *</span>
00007 <span class="comment"> *   Original RTAI/PPC layer implementation: \n</span>
00008 <span class="comment"> *   Copyright &amp;copy; 2000 Paolo Mantegazza, \n</span>
00009 <span class="comment"> *   Copyright &amp;copy; 2001 David Schleef, \n</span>
00010 <span class="comment"> *   Copyright &amp;copy; 2001 Lineo, Inc, \n</span>
00011 <span class="comment"> *   Copyright &amp;copy; 2002 Wolfgang Grandegger. \n</span>
00012 <span class="comment"> *</span>
00013 <span class="comment"> *   RTAI/x86 rewrite over Adeos: \n</span>
00014 <span class="comment"> *   Copyright &amp;copy 2002 Philippe Gerum.</span>
00015 <span class="comment"> *</span>
00016 <span class="comment"> *   RTAI/PPC rewrite over Adeos: \n</span>
00017 <span class="comment"> *   Copyright &amp;copy 2004 Wolfgang Grandegger.</span>
00018 <span class="comment"></span>
00019 <span class="comment"> *   This program is free software; you can redistribute it and/or modify</span>
00020 <span class="comment"> *   it under the terms of the GNU General Public License as published by</span>
00021 <span class="comment"> *   the Free Software Foundation, Inc., 675 Mass Ave, Cambridge MA 02139,</span>
00022 <span class="comment"> *   USA; either version 2 of the License, or (at your option) any later</span>
00023 <span class="comment"> *   version.</span>
00024 <span class="comment"> *</span>
00025 <span class="comment"> *   This program is distributed in the hope that it will be useful,</span>
00026 <span class="comment"> *   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00027 <span class="comment"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00028 <span class="comment"> *   GNU General Public License for more details.</span>
00029 <span class="comment"> *</span>
00030 <span class="comment"> *   You should have received a copy of the GNU General Public License</span>
00031 <span class="comment"> *   along with this program; if not, write to the Free Software</span>
00032 <span class="comment"> *   Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span>
00033 <span class="comment"> */</span>
00034 
00035 <span class="preprocessor">#ifndef _RTAI_ASM_PPC_OLDNAMES_H</span>
00036 <span class="preprocessor"></span><span class="preprocessor">#define _RTAI_ASM_PPC_OLDNAMES_H</span>
00037 <span class="preprocessor"></span>
00038 <span class="preprocessor">#ifdef __KERNEL__</span>
00039 <span class="preprocessor"></span>
00040 <span class="preprocessor">#define IFLAG                        RTAI_IFLAG</span>
00041 <span class="preprocessor"></span><span class="preprocessor">#define hard_cli()                   rtai_cli()</span>
00042 <span class="preprocessor"></span><span class="preprocessor">#define hard_sti()                   rtai_sti()</span>
00043 <span class="preprocessor"></span><span class="preprocessor">#define hard_save_flags_and_cli(x)   rtai_local_irq_save(x)</span>
00044 <span class="preprocessor"></span><span class="preprocessor">#define hard_restore_flags(x)        rtai_local_irq_restore(x)</span>
00045 <span class="preprocessor"></span><span class="preprocessor">#define hard_save_flags(x)           rtai_local_irq_flags(x)</span>
00046 <span class="preprocessor"></span><span class="preprocessor">#define hard_cpu_id                  adeos_processor_id</span>
00047 <span class="preprocessor"></span><span class="preprocessor">#define this_rt_task                 ptd</span>
00048 <span class="preprocessor"></span>
00049 <span class="preprocessor">#endif </span><span class="comment">/* __KERNEL__ */</span>
00050 
00051 <span class="preprocessor">#ifndef __RTAI_HAL__</span>
00052 <span class="preprocessor"></span>
00053 <span class="preprocessor">#define tuned           rtai_tunables</span>
00054 <span class="preprocessor"></span><span class="preprocessor">#define NR_RT_CPUS      RTAI_NR_CPUS</span>
00055 <span class="preprocessor"></span><span class="preprocessor">#define RT_TIME_END     RTAI_TIME_LIMIT</span>
00056 <span class="preprocessor"></span>
00057 <span class="preprocessor">#define CPU_FREQ        RTAI_CPU_FREQ</span>
00058 <span class="preprocessor"></span><span class="preprocessor">#define TIMER_8254_IRQ  RTAI_TIMER_8254_IRQ</span>
00059 <span class="preprocessor"></span><span class="preprocessor">#define FREQ_8254       RTAI_FREQ_8254</span>
00060 <span class="preprocessor"></span><span class="preprocessor">#define LATENCY_8254    RTAI_LATENCY_8254</span>
00061 <span class="preprocessor"></span><span class="preprocessor">#define SETUP_TIME_8254 RTAI_SETUP_TIME_8254</span>
00062 <span class="preprocessor"></span>
00063 <span class="preprocessor">#define FREQ_APIC       RTAI_FREQ_APIC</span>
00064 <span class="preprocessor"></span><span class="preprocessor">#define LATENCY_APIC    RTAI_LATENCY_APIC</span>
00065 <span class="preprocessor"></span><span class="preprocessor">#define SETUP_TIME_APIC RTAI_SETUP_TIME_APIC</span>
00066 <span class="preprocessor"></span>
00067 <span class="preprocessor">#define CALIBRATED_APIC_FREQ  RTAI_CALIBRATED_APIC_FREQ</span>
00068 <span class="preprocessor"></span><span class="preprocessor">#define CALIBRATED_CPU_FREQ   RTAI_CALIBRATED_CPU_FREQ</span>
00069 <span class="preprocessor"></span>
00070 <span class="preprocessor">#ifdef __KERNEL__</span>
00071 <span class="preprocessor"></span>
00072 <span class="comment">/* For compatibility reasons with RTHAL, IPIs numbers are indices into</span>
00073 <span class="comment">   the __ipi2vec[] array, instead of actual interrupt numbers. */</span>
00074 
00075 <span class="preprocessor">#define RTAI_1_VECTOR  RTAI_APIC1_VECTOR</span>
00076 <span class="preprocessor"></span><span class="preprocessor">#define RTAI_1_IPI     6</span>
00077 <span class="preprocessor"></span><span class="preprocessor">#define RTAI_2_VECTOR  RTAI_APIC2_VECTOR</span>
00078 <span class="preprocessor"></span><span class="preprocessor">#define RTAI_2_IPI     7</span>
00079 <span class="preprocessor"></span><span class="preprocessor">#define RTAI_3_VECTOR  RTAI_APIC3_VECTOR</span>
00080 <span class="preprocessor"></span><span class="preprocessor">#define RTAI_3_IPI     8</span>
00081 <span class="preprocessor"></span><span class="preprocessor">#define RTAI_4_VECTOR  RTAI_APIC4_VECTOR</span>
00082 <span class="preprocessor"></span><span class="preprocessor">#define RTAI_4_IPI     9</span>
00083 <span class="preprocessor"></span>
00084 <span class="preprocessor">#define broadcast_to_local_timers rtai_broadcast_to_timers</span>
00085 <span class="preprocessor"></span><span class="preprocessor">#define rtai_signal_handler       rtai_signal_handler</span>
00086 <span class="preprocessor"></span><span class="preprocessor">#define rt_set_rtai_trap_handler  rt_set_trap_handler</span>
00087 <span class="preprocessor"></span><span class="preprocessor">#define rt_mount_rtai             rt_mount</span>
00088 <span class="preprocessor"></span><span class="preprocessor">#define rt_umount_rtai            rt_umount</span>
00089 <span class="preprocessor"></span><span class="preprocessor">#define calibrate_8254            rtai_calibrate_8254</span>
00090 <span class="preprocessor"></span>
00091 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> rt_request_global_irq_ext(<span class="keywordtype">unsigned</span> irq,
00092                                             <span class="keywordtype">void</span> (*handler)(<span class="keywordtype">void</span>),
00093                                             <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> cookie) {
00094 
00095     <span class="keywordflow">return</span> rt_request_irq(irq,(<span class="keywordtype">void</span> (*)(<span class="keywordtype">unsigned</span>,<span class="keywordtype">void</span> *))handler,(<span class="keywordtype">void</span> *)cookie);
00096 }
00097 
00098 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> rt_request_global_irq(<span class="keywordtype">unsigned</span> irq,
00099                                         <span class="keywordtype">void</span> (*handler)(<span class="keywordtype">void</span>)) {
00100 
00101     <span class="keywordflow">return</span> rt_request_irq(irq,(<span class="keywordtype">void</span> (*)(<span class="keywordtype">unsigned</span>,<span class="keywordtype">void</span> *))handler,0);
00102 }
00103 
00104 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> rt_set_global_irq_ext(<span class="keywordtype">unsigned</span> irq,
00105                                          <span class="keywordtype">int</span> ext,
00106                                          <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> cookie) {
00107 
00108     rt_set_irq_cookie(irq,(<span class="keywordtype">void</span> *)cookie);
00109 }
00110 
00111 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> rt_free_global_irq(<span class="keywordtype">unsigned</span> irq) {
00112 
00113     <span class="keywordflow">return</span> rt_release_irq(irq);
00114 }
00115 
00116 <span class="preprocessor">#undef  rdtsc</span>
00117 <span class="preprocessor"></span><span class="preprocessor">#define rdtsc()     rtai_rdtsc()</span>
00118 <span class="preprocessor"></span><span class="preprocessor">#define rd_CPU_ts() rdtsc()</span>
00119 <span class="preprocessor"></span>
00120 <span class="preprocessor">#define ulldiv(a,b,c)  rtai_ulldiv(a,b,c)</span>
00121 <span class="preprocessor"></span><span class="preprocessor">#define imuldiv(a,b,c) rtai_imuldiv(a,b,c)</span>
00122 <span class="preprocessor"></span><span class="preprocessor">#define llimd(a,b,c)   rtai_llimd(a,b,c)</span>
00123 <span class="preprocessor"></span>
00124 <span class="preprocessor">#define locked_cpus                        (&amp;rtai_cpu_lock)</span>
00125 <span class="preprocessor"></span>
00126 <span class="preprocessor">#define lxrt_hrt_flags        rtai_cpu_lxrt</span>
00127 <span class="preprocessor"></span><span class="preprocessor">#define rtai_print_to_screen  rt_printk</span>
00128 <span class="preprocessor"></span>
00129 <span class="preprocessor">#define RTAI_NR_TRAPS         ADEOS_NR_FAULTS</span>
00130 <span class="preprocessor"></span>
00131 <span class="preprocessor">#define DECLR_8254_TSC_EMULATION</span>
00132 <span class="preprocessor"></span><span class="preprocessor">#define TICK_8254_TSC_EMULATION</span>
00133 <span class="preprocessor"></span><span class="preprocessor">#define SETUP_8254_TSC_EMULATION</span>
00134 <span class="preprocessor"></span><span class="preprocessor">#define CLEAR_8254_TSC_EMULATION</span>
00135 <span class="preprocessor"></span>
00136 <span class="preprocessor">#ifndef __cplusplus</span>
00137 <span class="preprocessor"></span>
00138 <span class="preprocessor">#include &lt;linux/irq.h&gt;</span>
00139 
00140 <span class="keyword">extern</span> <span class="keyword">struct </span>desc_struct idt_table[];
00141 
00142 <span class="keyword">extern</span> <span class="keyword">struct </span>rt_hal rthal;
00143 
00144 <span class="preprocessor">#ifdef FIXME</span>
00145 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span>desc_struct rt_set_full_intr_vect (unsigned vector,
00146                                                         int type,
00147                                                         int dpl,
00148                                                         void (*handler)(void)) {
00149     <span class="keyword">struct </span>desc_struct e = idt_table[vector];
00150     idt_table[vector].a = (__KERNEL_CS &lt;&lt; 16) | ((unsigned)handler &amp; 0x0000FFFF);
00151     idt_table[vector].b = ((unsigned)handler &amp; 0xFFFF0000) | (0x8000 + (dpl &lt;&lt; 13) + (type &lt;&lt; 8));
00152     <span class="keywordflow">return</span> e;
00153 }
00154 
00155 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> rt_reset_full_intr_vect(<span class="keywordtype">unsigned</span> vector,
00156                                            <span class="keyword">struct</span> desc_struct e) {
00157     idt_table[vector] = e;
00158 }
00159 
00160 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> __ipi2vec[] = {
00161     INVALIDATE_TLB_VECTOR,
00162     LOCAL_TIMER_VECTOR,
00163     RESCHEDULE_VECTOR,
00164     CALL_FUNCTION_VECTOR,
00165     SPURIOUS_APIC_VECTOR,
00166     ERROR_APIC_VECTOR,
00167     -1,                 <span class="comment">/* RTAI_1_VECTOR: reserved */</span>
00168     -1,                 <span class="comment">/* RTAI_2_VECTOR: reserved */</span>
00169     RTAI_3_VECTOR,
00170     RTAI_4_VECTOR
00171 };
00172 
00173 <span class="preprocessor">#define __vec2irq(v) ((v) - FIRST_EXTERNAL_VECTOR)</span>
00174 <span class="preprocessor"></span>
00175 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> __ipi2irq[] = {
00176     __vec2irq(INVALIDATE_TLB_VECTOR),
00177     __vec2irq(LOCAL_TIMER_VECTOR),
00178     __vec2irq(RESCHEDULE_VECTOR),
00179     __vec2irq(CALL_FUNCTION_VECTOR),
00180     __vec2irq(SPURIOUS_APIC_VECTOR),
00181     __vec2irq(ERROR_APIC_VECTOR),
00182     (unsigned)-1,       <span class="comment">/* RTAI_1_IPI: reserved */</span>
00183     (unsigned)-1,       <span class="comment">/* RTAI_2_IPI: reserved */</span>
00184     RTAI_APIC3_IPI,
00185     RTAI_APIC4_IPI
00186 };
00187 <span class="preprocessor">#endif</span>
00188 <span class="preprocessor"></span>
00189 <span class="comment">/* cpu_own_irq() routines are RTHAL-specific and emulated here for</span>
00190 <span class="comment">   compatibility purposes. */</span>
00191 
00192 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> rt_request_cpu_own_irq (<span class="keywordtype">unsigned</span> ipi, <span class="keywordtype">void</span> (*handler)(<span class="keywordtype">void</span>)) {
00193 
00194 <span class="preprocessor">#ifdef FIXME</span>
00195 <span class="preprocessor"></span>    <span class="keywordflow">return</span> ipi &lt; 10 ? rt_request_irq(__ipi2irq[ipi],(rt_irq_handler_t)handler,0) : -EINVAL;
00196 <span class="preprocessor">#else</span>
00197 <span class="preprocessor"></span>    <span class="keywordflow">return</span> 0;
00198 <span class="preprocessor">#endif</span>
00199 <span class="preprocessor"></span>}
00200 
00201 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> rt_free_cpu_own_irq (<span class="keywordtype">unsigned</span> ipi) {
00202 
00203 <span class="preprocessor">#ifdef FIXME</span>
00204 <span class="preprocessor"></span>    <span class="keywordflow">return</span> ipi &lt; 10 ? rt_release_irq(__ipi2irq[ipi]) : -EINVAL;
00205 <span class="preprocessor">#else</span>
00206 <span class="preprocessor"></span>    <span class="keywordflow">return</span> 0;
00207 <span class="preprocessor">#endif</span>
00208 <span class="preprocessor"></span>}
00209 
00210 <span class="preprocessor">#ifdef CONFIG_SMP</span>
00211 <span class="preprocessor"></span>
00212 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> send_ipi_shorthand (<span class="keywordtype">unsigned</span> shorthand,
00213                                        <span class="keywordtype">int</span> irq) {
00214     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> flags;
00215     rtai_hw_lock(flags);
00216     apic_wait_icr_idle();
00217     apic_write_around(APIC_ICR,APIC_DEST_LOGICAL|shorthand|__ipi2vec[irq]);
00218     rtai_hw_unlock(flags);
00219 }
00220 
00221 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> send_ipi_logical (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> dest,
00222                                      <span class="keywordtype">int</span> irq) {
00223     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> flags;
00224 
00225     <span class="keywordflow">if</span> ((dest &amp;= cpu_online_map) != 0)
00226         {
00227         rtai_hw_lock(flags);
00228         apic_wait_icr_idle();
00229         apic_write_around(APIC_ICR2,SET_APIC_DEST_FIELD(dest));
00230         apic_write_around(APIC_ICR,APIC_DEST_LOGICAL|__ipi2vec[irq]);
00231         rtai_hw_unlock(flags);
00232         }
00233 }
00234 
00235 <span class="preprocessor">#endif </span><span class="comment">/* CONFIG_SMP */</span>
00236 
00237 <span class="preprocessor">#ifdef FIXME</span>
00238 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> *get_intr_handler (<span class="keywordtype">unsigned</span> vector) {
00239 
00240     <span class="keywordflow">return</span> (<span class="keywordtype">void</span> *)((idt_table[vector].b &amp; 0xFFFF0000) | 
00241                     (idt_table[vector].a &amp; 0x0000FFFF));
00242 }
00243 
00244 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> set_intr_vect (<span class="keywordtype">unsigned</span> vector,
00245                                   <span class="keywordtype">void</span> (*handler)(<span class="keywordtype">void</span>)) {
00246 
00247     idt_table[vector].a = (idt_table[vector].a &amp; 0xFFFF0000) | 
00248         ((unsigned)handler &amp; 0x0000FFFF);
00249     idt_table[vector].b = ((unsigned)handler &amp; 0xFFFF0000) | 
00250         (idt_table[vector].b &amp; 0x0000FFFF);
00251 }
00252 
00253 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> *rt_set_intr_handler (<span class="keywordtype">unsigned</span> vector,
00254                                          <span class="keywordtype">void</span> (*handler)(<span class="keywordtype">void</span>)) {
00255 
00256     void (*saved_handler)(void) = get_intr_handler(vector);
00257     set_intr_vect(vector, handler);
00258     <span class="keywordflow">return</span> saved_handler;
00259 }
00260 
00261 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> rt_reset_intr_handler (<span class="keywordtype">unsigned</span> vector,
00262                                           <span class="keywordtype">void</span> (*handler)(<span class="keywordtype">void</span>)) {
00263     set_intr_vect(vector, handler);
00264 }
00265 
00266 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> get_cr2 (<span class="keywordtype">void</span>) {
00267 
00268     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> address;
00269     __asm__(<span class="stringliteral">"movl %%cr2,%0"</span>:<span class="stringliteral">"=r"</span> (address));
00270     <span class="keywordflow">return</span> address;
00271 }
00272 <span class="preprocessor">#endif</span>
00273 <span class="preprocessor"></span>
00274 <span class="preprocessor">#endif </span><span class="comment">/* __KERNEL__ */</span>
00275 
00276 <span class="preprocessor">#endif </span><span class="comment">/* !__cplusplus */</span>
00277 
00278 <span class="preprocessor">#endif </span><span class="comment">/* __RTAI_HAL__ */</span>
00279 
00280 <span class="preprocessor">#endif </span><span class="comment">/* !_RTAI_ASM_PPC_OLDNAMES_H */</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Jan 18 22:53:52 2005 for RTAI API by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
