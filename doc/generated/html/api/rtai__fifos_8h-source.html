<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RTAI API: base/include/rtai_fifos.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<div class="nav">
<a class="el" href="dir_000000.html">base</a>&nbsp;/&nbsp;<a class="el" href="dir_000015.html">include</a></div>
<h1>rtai_fifos.h</h1><a href="rtai__fifos_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00026 <span class="preprocessor">#ifndef _RTAI_FIFOS_H</span>
00027 <span class="preprocessor"></span><span class="preprocessor">#define _RTAI_FIFOS_H</span>
00028 <span class="preprocessor"></span>
00029 <span class="preprocessor">#include &lt;rtai_types.h&gt;</span>
00030 
00031 <span class="preprocessor">#define MAX_FIFOS 64</span>
00032 <span class="preprocessor"></span>
00033 <span class="preprocessor">#define RTAI_FIFOS_MAJOR 150</span>
00034 <span class="preprocessor"></span>
00035 <span class="preprocessor">#define RESET                   1</span>
00036 <span class="preprocessor"></span><span class="preprocessor">#define RESIZE                  2</span>
00037 <span class="preprocessor"></span><span class="preprocessor">#define RTF_SUSPEND_TIMED       3</span>
00038 <span class="preprocessor"></span><span class="preprocessor">#define OPEN_SIZED              4</span>
00039 <span class="preprocessor"></span><span class="preprocessor">#define READ_ALL_AT_ONCE        5</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#define READ_TIMED              6</span>
00041 <span class="preprocessor"></span><span class="preprocessor">#define WRITE_TIMED             7</span>
00042 <span class="preprocessor"></span><span class="preprocessor">#define RTF_SEM_INIT            8</span>
00043 <span class="preprocessor"></span><span class="preprocessor">#define RTF_SEM_WAIT            9</span>
00044 <span class="preprocessor"></span><span class="preprocessor">#define RTF_SEM_TRYWAIT         10</span>
00045 <span class="preprocessor"></span><span class="preprocessor">#define RTF_SEM_TIMED_WAIT      11</span>
00046 <span class="preprocessor"></span><span class="preprocessor">#define RTF_SEM_POST            12</span>
00047 <span class="preprocessor"></span><span class="preprocessor">#define RTF_SEM_DESTROY         13</span>
00048 <span class="preprocessor"></span><span class="preprocessor">#define SET_ASYNC_SIG           14</span>
00049 <span class="preprocessor"></span><span class="preprocessor">#define EAVESDROP               19</span>
00050 <span class="preprocessor"></span><span class="preprocessor">#define OVRWRITE                20</span>
00051 <span class="preprocessor"></span><span class="preprocessor">#define READ_IF                 21</span>
00052 <span class="preprocessor"></span><span class="preprocessor">#define WRITE_IF                22</span>
00053 <span class="preprocessor"></span><span class="preprocessor">#define RTF_NAMED_CREATE        23</span>
00054 <span class="preprocessor"></span>
00055 <span class="preprocessor">#define RTF_GET_N_FIFOS         15</span>
00056 <span class="preprocessor"></span><span class="preprocessor">#define RTF_GET_FIFO_INFO       16</span>
00057 <span class="preprocessor"></span><span class="preprocessor">#define RTF_CREATE_NAMED        17</span>
00058 <span class="preprocessor"></span><span class="preprocessor">#define RTF_NAME_LOOKUP         18</span>
00059 <span class="preprocessor"></span>
00060 <span class="preprocessor">#define RTF_NAMELEN 15</span>
00061 <span class="preprocessor"></span>
00062 <span class="keyword">struct </span>rt_fifo_info_struct{
00063         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo_number;
00064         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size;
00065         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> opncnt;
00066         <span class="keywordtype">char</span> name[RTF_NAMELEN+1];
00067 };
00068 
00069 <span class="keyword">struct </span>rt_fifo_get_info_struct{
00070         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo;
00071         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n;
00072         <span class="keyword">struct </span>rt_fifo_info_struct *ptr;
00073 };
00074 
00075 <span class="preprocessor">#define  FUN_FIFOS_LXRT_INDX 10</span>
00076 <span class="preprocessor"></span>
00077 <span class="preprocessor">#define _CREATE         0</span>
00078 <span class="preprocessor"></span><span class="preprocessor">#define _DESTROY        1</span>
00079 <span class="preprocessor"></span><span class="preprocessor">#define _PUT            2</span>
00080 <span class="preprocessor"></span><span class="preprocessor">#define _GET            3</span>
00081 <span class="preprocessor"></span><span class="preprocessor">#define _RESET          4</span>
00082 <span class="preprocessor"></span><span class="preprocessor">#define _RESIZE         5</span>
00083 <span class="preprocessor"></span><span class="preprocessor">#define _SEM_INIT       6</span>
00084 <span class="preprocessor"></span><span class="preprocessor">#define _SEM_DESTRY     7</span>
00085 <span class="preprocessor"></span><span class="preprocessor">#define _SEM_POST       8</span>
00086 <span class="preprocessor"></span><span class="preprocessor">#define _SEM_TRY        9</span>
00087 <span class="preprocessor"></span><span class="preprocessor">#define _CREATE_NAMED  10</span>
00088 <span class="preprocessor"></span><span class="preprocessor">#define _GETBY_NAME    11</span>
00089 <span class="preprocessor"></span><span class="preprocessor">#define _OVERWRITE     12</span>
00090 <span class="preprocessor"></span><span class="preprocessor">#define _PUT_IF        13</span>
00091 <span class="preprocessor"></span><span class="preprocessor">#define _GET_IF        14</span>
00092 <span class="preprocessor"></span><span class="preprocessor">#define _NAMED_CREATE  15</span>
00093 <span class="preprocessor"></span>
00094 <span class="preprocessor">#ifdef __KERNEL__</span>
00095 <span class="preprocessor"></span>
00096 <span class="preprocessor">#ifdef __cplusplus</span>
00097 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
00098 <span class="preprocessor">#endif </span><span class="comment">/* __cplusplus */</span>
00099 
00100 <span class="keywordtype">int</span> __rtai_fifos_init(<span class="keywordtype">void</span>);
00101 
00102 <span class="keywordtype">void</span> __rtai_fifos_exit(<span class="keywordtype">void</span>);
00103 
00104 <span class="keywordtype">int</span> rtf_init(<span class="keywordtype">void</span>);
00105 
00106 <span class="comment">/* Attach a handler to an RT-FIFO.</span>
00107 <span class="comment"> *</span>
00108 <span class="comment"> * Allow function handler to be called when a user process reads or writes to </span>
00109 <span class="comment"> * the FIFO. When the function is called, it is passed the fifo number as the </span>
00110 <span class="comment"> * argument.</span>
00111 <span class="comment"> */</span>
00112 
00113 <span class="keywordtype">int</span> <a class="code" href="group__fifos__ipc.html#ga10">rtf_create_handler</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo,       <span class="comment">/* RT-FIFO */</span>
00114                        <span class="keywordtype">int</span> (*handler)(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo)        <span class="comment">/* function to be called */</span>);
00115 
00116 
00129 <span class="preprocessor">#define X_FIFO_HANDLER(handler) ((int (*)(unsigned int))(handler))</span>
00130 <span class="preprocessor"></span>
00131 <span class="comment">/* Create an RT-FIFO.</span>
00132 <span class="comment"> * </span>
00133 <span class="comment"> * An RT-FIFO fifo is created with initial size of size.</span>
00134 <span class="comment"> * Return value: On success, 0 is returned. On error, -1 is returned.</span>
00135 <span class="comment"> */</span>
00136 <span class="preprocessor">#undef rtf_create</span>
00137 <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="group__fifos__ipc.html#ga8">rtf_create</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo, <span class="keywordtype">int</span> size);
00138 
00139 <span class="comment">/* Create an RT-FIFO with a name and size.</span>
00140 <span class="comment"> *</span>
00141 <span class="comment"> * An RT-FIFO is created with a name of name, it will be allocated</span>
00142 <span class="comment"> * the first unused minor number and will have a user assigned size.</span>
00143 <span class="comment"> * Return value: On success, the allocated minor number is returned.</span>
00144 <span class="comment"> *               On error, -errno is returned.</span>
00145 <span class="comment"> */</span>
00146 
00147 <span class="keywordtype">int</span> rtf_named_create(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">int</span> size);
00148 
00149 <span class="comment">/* Create an RT-FIFO with a name.</span>
00150 <span class="comment"> *</span>
00151 <span class="comment"> * An RT-FIFO is created with a name of name, it will be allocated</span>
00152 <span class="comment"> * the first unused minor number and will have a default size.</span>
00153 <span class="comment"> * Return value: On success, the allocated minor number is returned. </span>
00154 <span class="comment"> *               On error, -errno is returned.</span>
00155 <span class="comment"> */</span>
00156 
00157 <span class="keywordtype">int</span> rtf_create_named(<span class="keyword">const</span> <span class="keywordtype">char</span> *name);
00158 
00159 <span class="comment">/* Look up a named RT-FIFO.</span>
00160 <span class="comment"> *</span>
00161 <span class="comment"> * Find the RT-FIFO with the name name.</span>
00162 <span class="comment"> * Return value: On success, the minor number is returned. </span>
00163 <span class="comment"> *               On error, -errno is returned.</span>
00164 <span class="comment"> */</span>
00165 
00166 <span class="keywordtype">int</span> rtf_getfifobyname(<span class="keyword">const</span> <span class="keywordtype">char</span> *name);
00167 
00168 <span class="comment">/* Reset an RT-FIFO.</span>
00169 <span class="comment"> * </span>
00170 <span class="comment"> * An RT-FIFO fifo is reset by setting its buffer pointers to zero, so</span>
00171 <span class="comment"> * that any existing data is discarded and the fifo started anew like at its</span>
00172 <span class="comment"> * creation.</span>
00173 <span class="comment"> */</span>
00174 
00175 <span class="keywordtype">int</span> <a class="code" href="group__fifos__ipc.html#ga6">rtf_reset</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo);
00176 
00177 <span class="comment">/* destroy an RT-FIFO.</span>
00178 <span class="comment"> * </span>
00179 <span class="comment"> * Return value: On success, 0 is returned.</span>
00180 <span class="comment"> */</span>
00181 
00182 <span class="keywordtype">int</span> <a class="code" href="group__fifos__ipc.html#ga9">rtf_destroy</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo);
00183 
00184 
00185 <span class="comment">/* Resize an RT-FIFO.</span>
00186 <span class="comment"> * </span>
00187 <span class="comment"> * Return value: size is returned on success. On error, a negative value</span>
00188 <span class="comment"> * is returned.</span>
00189 <span class="comment"> */</span>
00190 
00191 <span class="keywordtype">int</span> <a class="code" href="group__fifos__ipc.html#ga7">rtf_resize</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> minor, <span class="keywordtype">int</span> size);
00192 
00193 
00194 <span class="comment">/* Write to an RT-FIFO.</span>
00195 <span class="comment"> *</span>
00196 <span class="comment"> * Try to write count bytes to an FIFO. Returns the number of bytes written.</span>
00197 <span class="comment"> */</span>
00198 
00199 <span class="keywordtype">int</span> <a class="code" href="group__fifos__ipc.html#ga11">rtf_put</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo,  <span class="comment">/* RT-FIFO */</span>
00200             <span class="keywordtype">void</span> * buf,         <span class="comment">/* buffer address */</span>
00201             <span class="keywordtype">int</span> count           <span class="comment">/* number of bytes to write */</span>);
00202 
00203 
00204 
00205 <span class="comment">/* Write to an RT-FIFO, over writing if there is not enough space.</span>
00206 <span class="comment"> *</span>
00207 <span class="comment"> * Try to write count bytes to an FIFO. Returns 0.</span>
00208 <span class="comment"> */</span>
00209 
00210 <span class="keywordtype">int</span> rtf_ovrwr_put(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo,    <span class="comment">/* RT-FIFO */</span>
00211                   <span class="keywordtype">void</span> * buf,           <span class="comment">/* buffer address */</span>
00212                   <span class="keywordtype">int</span> count             <span class="comment">/* number of bytes to write */</span>);
00213 
00214 
00215 
00216 <span class="comment">/* Write atomically to an RT-FIFO.</span>
00217 <span class="comment"> *</span>
00218 <span class="comment"> * Try to write count bytes in block to an FIFO. Returns the number of bytes</span>
00219 <span class="comment"> * written.</span>
00220 <span class="comment"> */</span>
00221 
00222 <span class="keyword">extern</span> <span class="keywordtype">int</span> rtf_put_if (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo,       <span class="comment">/* RT-FIFO */</span>
00223                 <span class="keywordtype">void</span> * buf,                     <span class="comment">/* buffer address */</span>
00224                 <span class="keywordtype">int</span> count                       <span class="comment">/* number of bytes to write */</span>);
00225 
00226 <span class="comment">/* Read from an RT-FIFO.</span>
00227 <span class="comment"> *</span>
00228 <span class="comment"> * Try to read count bytes from a FIFO. Returns the number of bytes read.</span>
00229 <span class="comment"> */</span>
00230 
00231 <span class="keywordtype">int</span> <a class="code" href="group__fifos__ipc.html#ga12">rtf_get</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo,  <span class="comment">/* RT-FIFO */</span>
00232             <span class="keywordtype">void</span> * buf,                 <span class="comment">/* buffer address */</span>
00233             <span class="keywordtype">int</span> count           <span class="comment">/* number of bytes to read */</span>);
00234 
00235 
00236 <span class="comment">/* Atomically read from an RT-FIFO.</span>
00237 <span class="comment"> *</span>
00238 <span class="comment"> * Try to read count bytes in a block from an FIFO. Returns the number of bytes read.</span>
00239 <span class="comment"> */</span>
00240 
00241 <span class="keywordtype">int</span> rtf_get_if(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo,       <span class="comment">/* RT-FIFO */</span>
00242             <span class="keywordtype">void</span> * buf,                 <span class="comment">/* buffer address */</span>
00243             <span class="keywordtype">int</span> count           <span class="comment">/* number of bytes to read */</span>);
00244 
00245 
00246 <span class="comment">/* </span>
00247 <span class="comment"> * Preview the an RT-FIFO content.</span>
00248 <span class="comment"> */</span>
00249 
00250 <span class="keywordtype">int</span> rtf_evdrp(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo,        <span class="comment">/* RT-FIFO */</span>
00251               <span class="keywordtype">void</span> * buf,               <span class="comment">/* buffer address */</span>
00252               <span class="keywordtype">int</span> count         <span class="comment">/* number of bytes to read */</span>);
00253 
00254 <span class="comment">/* Open an RT-FIFO semaphore.</span>
00255 <span class="comment"> *</span>
00256 <span class="comment"> */</span>
00257 
00258 <span class="keywordtype">int</span> <a class="code" href="group__fifos__sem.html#ga2">rtf_sem_init</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo,     <span class="comment">/* RT-FIFO */</span>
00259                  <span class="keywordtype">int</span> value                      <span class="comment">/* initial semaphore value */</span>);
00260 
00261 
00262 <span class="comment">/* Post to an RT-FIFO semaphore.</span>
00263 <span class="comment"> *</span>
00264 <span class="comment"> */</span>
00265 
00266 <span class="keywordtype">int</span> <a class="code" href="group__fifos__sem.html#ga3">rtf_sem_post</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo      <span class="comment">/* RT-FIFO */</span>);
00267 
00268 
00269 <span class="comment">/* Try to acquire an RT-FIFO semaphore.</span>
00270 <span class="comment"> *</span>
00271 <span class="comment"> */</span>
00272 
00273 <span class="keywordtype">int</span> <a class="code" href="group__fifos__sem.html#ga4">rtf_sem_trywait</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo   <span class="comment">/* RT-FIFO */</span>);
00274 
00275 
00276 <span class="comment">/* Destroy an RT-FIFO semaphore.</span>
00277 <span class="comment"> *</span>
00278 <span class="comment"> */</span>
00279 
00280 <span class="keywordtype">int</span> <a class="code" href="group__fifos__sem.html#ga5">rtf_sem_destroy</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo   <span class="comment">/* RT-FIFO */</span>);
00281 
00282 <span class="preprocessor">#define rtf_sem_delete rtf_sem_destroy</span>
00283 <span class="preprocessor"></span>
00284 <span class="comment">/* Just for compatibility with earlier rtai_fifos releases. No more bh and user</span>
00285 <span class="comment">buffers. Fifos are now awakened immediately and buffers &gt; 128K are vmalloced */</span>
00286 
00287 <span class="preprocessor">#define rtf_create_using_bh(fifo, size, bh_list) rtf_create(fifo, size)</span>
00288 <span class="preprocessor"></span><span class="preprocessor">#define rtf_create_using_bh_and_usr_buf(fifo, buf, size, bh_list) rtf_create(fifo, size)</span>
00289 <span class="preprocessor"></span><span class="preprocessor">#define rtf_destroy_using_usr_buf(fifo) rtf_destroy(fifo)</span>
00290 <span class="preprocessor"></span>
00291 <span class="preprocessor">#ifdef __cplusplus</span>
00292 <span class="preprocessor"></span>}
00293 <span class="preprocessor">#endif </span><span class="comment">/* __cplusplus */</span>
00294 
00295 <span class="preprocessor">#else  </span><span class="comment">/* !__KERNEL__ */</span>
00296 
00297 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
00298 <span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
00299 <span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span>
00300 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
00301 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
00302 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00303 <span class="preprocessor">#include &lt;string.h&gt;</span>
00304 <span class="preprocessor">#include &lt;<a class="code" href="rtai__lxrt_8h.html">rtai_lxrt.h</a>&gt;</span>
00305 
00306 <span class="preprocessor">#ifdef __cplusplus</span>
00307 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
00308 <span class="preprocessor">#endif </span><span class="comment">/* __cplusplus */</span>
00309 
00310 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_create,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo, <span class="keywordtype">int</span> size))
00311 {
00312         <span class="keyword">struct </span>{ <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo, size; } arg = { fifo, size }; 
00313         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _CREATE, &amp;arg).i[LOW];
00314 }
00315 
00316 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_destroy,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo))
00317 {
00318         <span class="keyword">struct </span>{ <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo; } arg = { fifo };
00319         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _DESTROY, &amp;arg).i[LOW];
00320 }
00321 
00322 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_put,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo, <span class="keyword">const</span> <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> count))
00323 {
00324         <span class="keywordtype">char</span> lbuf[count];
00325         <span class="keyword">struct </span>{ <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo; <span class="keywordtype">void</span> *buf; <span class="keywordtype">int</span> count; } arg = { fifo, lbuf, count };
00326         memcpy(lbuf, buf, count);
00327         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _PUT, &amp;arg).i[LOW];
00328 }
00329 
00330 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_put_if,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo, <span class="keyword">const</span> <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> count))
00331 {
00332         <span class="keywordtype">char</span> lbuf[count];
00333         <span class="keyword">struct </span>{ <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo; <span class="keywordtype">void</span> *buf; <span class="keywordtype">int</span> count; } arg = { fifo, lbuf, count };
00334         memcpy(lbuf, buf, count);
00335         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _PUT_IF, &amp;arg).i[LOW];
00336 }
00337 
00338 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_get,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo, <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> count))
00339 {
00340         <span class="keywordtype">int</span> retval;
00341         <span class="keywordtype">char</span> lbuf[count];
00342         <span class="keyword">struct </span>{ <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo; <span class="keywordtype">void</span> *buf; <span class="keywordtype">int</span> count; } arg = { fifo, lbuf, count };
00343         retval = rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _GET, &amp;arg).i[LOW];
00344         <span class="keywordflow">if</span> (retval &gt; 0) {
00345                 memcpy(buf, lbuf, retval);
00346         }
00347         <span class="keywordflow">return</span> retval;
00348 }
00349 
00350 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_get_if,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo, <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> count))
00351 {
00352         <span class="keywordtype">int</span> retval;
00353         <span class="keywordtype">char</span> lbuf[count];
00354         <span class="keyword">struct </span>{ <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo; <span class="keywordtype">void</span> *buf; <span class="keywordtype">int</span> count; } arg = { fifo, lbuf, count };
00355         retval = rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _GET_IF, &amp;arg).i[LOW];
00356         <span class="keywordflow">if</span> (retval &gt; 0) {
00357                 memcpy(buf, lbuf, retval);
00358         }
00359         <span class="keywordflow">return</span> retval;
00360 }
00361 
00362 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_reset_lxrt,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo))
00363 {
00364         <span class="keyword">struct </span>{ <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo; } arg = { fifo };
00365         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _RESET, &amp;arg).i[LOW];
00366 }
00367 
00368 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_resize_lxrt,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo, <span class="keywordtype">int</span> size))
00369 {
00370         <span class="keyword">struct </span>{ <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo, size; } arg = { fifo, size }; 
00371         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _RESIZE, &amp;arg).i[LOW];
00372 }
00373 
00374 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_sem_init_lxrt,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo, <span class="keywordtype">int</span> value))
00375 {
00376         <span class="keyword">struct </span>{ <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo, value; } arg = { fifo, value }; 
00377         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _SEM_INIT, &amp;arg).i[LOW];
00378 }
00379 
00380 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_sem_post_lxrt,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo))
00381 {
00382         <span class="keyword">struct </span>{ <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo; } arg = { fifo }; 
00383         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _SEM_POST, &amp;arg).i[LOW];
00384 }
00385 
00386 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_sem_trywait_lxrt,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo))
00387 {
00388         <span class="keyword">struct </span>{ <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo; } arg = { fifo }; 
00389         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _SEM_TRY, &amp;arg).i[LOW];
00390 }
00391 
00392 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_sem_destroy_lxrt,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo))
00393 {
00394         <span class="keyword">struct </span>{ <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo; } arg = { fifo }; 
00395         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _SEM_DESTRY, &amp;arg).i[LOW];
00396 }
00397 
00398 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_named_create_lxrt,(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">int</span> size))
00399 {
00400         <span class="keywordtype">int</span> len;
00401         <span class="keywordtype">char</span> lname[len = strlen(name)];
00402         <span class="keyword">struct </span>{ <span class="keywordtype">char</span> * name; <span class="keywordtype">int</span> size; } arg = { lname, size };
00403         strncpy(lname, name, len);
00404         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _NAMED_CREATE, &amp;arg).i[LOW];
00405 }
00406 
00407 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_create_named_lxrt,(<span class="keyword">const</span> <span class="keywordtype">char</span> *name))
00408 {
00409         <span class="keywordtype">int</span> len;
00410         <span class="keywordtype">char</span> lname[len = strlen(name)];
00411         <span class="keyword">struct </span>{ <span class="keywordtype">char</span> * name; } arg = { lname };
00412         strncpy(lname, name, len);
00413         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _CREATE_NAMED, &amp;arg).i[LOW];
00414 }
00415 
00416 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_getfifobyname_lxrt,(<span class="keyword">const</span> <span class="keywordtype">char</span> *name))
00417 {
00418         <span class="keywordtype">int</span> len;
00419         <span class="keywordtype">char</span> lname[len = strlen(name)];
00420         <span class="keyword">struct </span>{ <span class="keywordtype">char</span> * name; } arg = { lname };
00421         strncpy(lname, name, len);
00422         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _GETBY_NAME, &amp;arg).i[LOW];
00423 }
00424 
00425 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_ovrwr_put,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo, <span class="keyword">const</span> <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> count))
00426 {
00427         <span class="keywordtype">char</span> lbuf[count];
00428         <span class="keyword">struct </span>{ <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fifo; <span class="keywordtype">void</span> *buf; <span class="keywordtype">int</span> count; } arg = { fifo, lbuf, count };
00429         memcpy(lbuf, buf, count);
00430         <span class="keywordflow">return</span> rtai_lxrt(FUN_FIFOS_LXRT_INDX, SIZARG, _OVERWRITE, &amp;arg).i[LOW];
00431 }
00432 
00433 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_reset,(<span class="keywordtype">int</span> fd))
00434 {
00435         <span class="keywordtype">int</span> ret = ioctl(fd, RESET);
00436         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00437 }
00438 
00439 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_resize,(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> size))
00440 {
00441         <span class="keywordtype">int</span> ret = ioctl(fd, RESIZE, size);
00442         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00443 }
00444 
<a name="l00459"></a><a class="code" href="group__fifos__ipc.html#ga0">00459</a> RTAI_PROTO(<span class="keywordtype">int</span>, rtf_suspend_timed,(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> ms_delay))
00460 {
00461         <span class="keywordtype">int</span> ret = ioctl(fd, RTF_SUSPEND_TIMED, ms_delay);
00462         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00463 }
00464 
<a name="l00499"></a><a class="code" href="group__fifos__ipc.html#ga1">00499</a> RTAI_PROTO(<span class="keywordtype">int</span>, rtf_open_sized,(<span class="keyword">const</span> <span class="keywordtype">char</span> *dev, <span class="keywordtype">int</span> perm, <span class="keywordtype">int</span> size))
00500 {
00501         <span class="keywordtype">int</span> fd;
00502 
00503         <span class="keywordflow">if</span> ((fd = open(dev, perm)) &lt; 0) { 
00504                 <span class="keywordflow">return</span> -errno;
00505         }
00506         <span class="keywordflow">if</span> (ioctl(fd, RESIZE, size) &lt; 0) {
00507                 close(fd);
00508                 <span class="keywordflow">return</span> -errno;
00509         }
00510         <span class="keywordflow">return</span> fd; 
00511 }
00512 
00513 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_evdrp,(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> count))
00514 {
00515         <span class="keyword">struct </span>{ <span class="keywordtype">void</span> *buf; <span class="keywordtype">int</span> count; } args = { buf, count };
00516         <span class="keywordtype">int</span> ret = ioctl(fd, EAVESDROP, &amp;args);
00517         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00518 }
00519 
<a name="l00536"></a><a class="code" href="group__fifos__ipc.html#ga2">00536</a> RTAI_PROTO(<span class="keywordtype">int</span>, rtf_read_all_at_once,(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> count))
00537 {
00538         <span class="keyword">struct </span>{ <span class="keywordtype">void</span> *buf; <span class="keywordtype">int</span> count; } args = { buf, count };
00539         <span class="keywordtype">int</span> ret = ioctl(fd, READ_ALL_AT_ONCE, &amp;args);
00540         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00541 }
00542 
<a name="l00564"></a><a class="code" href="group__fifos__ipc.html#ga3">00564</a> RTAI_PROTO(<span class="keywordtype">int</span>, rtf_read_timed,(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> count, <span class="keywordtype">int</span> ms_delay))
00565 {
00566         <span class="keyword">struct </span>{ <span class="keywordtype">void</span> *buf; <span class="keywordtype">int</span> count, delay; } args = { buf, count, ms_delay };
00567         <span class="keywordtype">int</span> ret = ioctl(fd, READ_TIMED, &amp;args);
00568         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00569 }
00570 
00571 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_read_if,(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> count))
00572 {
00573         <span class="keyword">struct </span>{ <span class="keywordtype">void</span> *buf; <span class="keywordtype">int</span> count; } args = { buf, count };
00574         <span class="keywordtype">int</span> ret = ioctl(fd, READ_IF, &amp;args);
00575         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00576 }
00577 
<a name="l00599"></a><a class="code" href="group__fifos__ipc.html#ga4">00599</a> RTAI_PROTO(<span class="keywordtype">int</span>, rtf_write_timed,(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> count, <span class="keywordtype">int</span> ms_delay))
00600 {
00601         <span class="keyword">struct </span>{ <span class="keywordtype">void</span> *buf; <span class="keywordtype">int</span> count, delay; } args = { buf, count, ms_delay };
00602         <span class="keywordtype">int</span> ret = ioctl(fd, WRITE_TIMED, &amp;args);
00603         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00604 }
00605 
00606 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_overwrite,(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> count))
00607 {
00608         <span class="keyword">struct </span>{ <span class="keywordtype">void</span> *buf; <span class="keywordtype">int</span> count; } args = { buf, count };
00609         <span class="keywordtype">int</span> ret = ioctl(fd, OVRWRITE, &amp;args);
00610         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00611 }
00612 
00613 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_write_if,(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> count))
00614 {
00615         <span class="keyword">struct </span>{ <span class="keywordtype">void</span> *buf; <span class="keywordtype">int</span> count; } args = { buf, count };
00616         <span class="keywordtype">int</span> ret = ioctl(fd, WRITE_IF, &amp;args);
00617         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00618 }
00619 
00620 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_sem_init,(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> value))
00621 {
00622         <span class="keywordtype">int</span> ret = ioctl(fd, RTF_SEM_INIT, value);
00623         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00624 }
00625 
<a name="l00648"></a><a class="code" href="group__fifos__sem.html#ga0">00648</a> RTAI_PROTO(<span class="keywordtype">int</span>, rtf_sem_wait,(<span class="keywordtype">int</span> fd))
00649 {
00650         <span class="keywordtype">int</span> ret = ioctl(fd, RTF_SEM_WAIT);
00651         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00652 }
00653 
00654 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_sem_trywait,(<span class="keywordtype">int</span> fd))
00655 {
00656         <span class="keywordtype">int</span> ret = ioctl(fd, RTF_SEM_TRYWAIT);
00657         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00658 }
00659 
<a name="l00686"></a><a class="code" href="group__fifos__sem.html#ga1">00686</a> RTAI_PROTO(<span class="keywordtype">int</span>, rtf_sem_timed_wait,(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> ms_delay))
00687 {
00688         <span class="keywordtype">int</span> ret = ioctl(fd, RTF_SEM_TIMED_WAIT, ms_delay);
00689         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00690 }
00691 
00692 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_sem_post,(<span class="keywordtype">int</span> fd))
00693 {
00694         <span class="keywordtype">int</span> ret = ioctl(fd, RTF_SEM_POST);
00695         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00696 }
00697 
00698 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_sem_destroy,(<span class="keywordtype">int</span> fd))
00699 {
00700         <span class="keywordtype">int</span> ret = ioctl(fd, RTF_SEM_DESTROY);
00701         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00702 }
00703 
<a name="l00715"></a><a class="code" href="group__fifos__ipc.html#ga5">00715</a> RTAI_PROTO(<span class="keywordtype">int</span>, rtf_set_async_sig,(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> signum))
00716 {
00717         <span class="keywordtype">int</span> ret = ioctl(fd, SET_ASYNC_SIG, signum);
00718         <span class="keywordflow">return</span> ret &lt; 0 ? -errno : ret;
00719 }
00720 
00721 <span class="comment">/*</span>
00722 <span class="comment"> * Support for named FIFOS : Ian Soanes (ians@zentropix.com)</span>
00723 <span class="comment"> * Based on ideas from Stuart Hughes and David Schleef</span>
00724 <span class="comment"> */</span>
00725 
00726 RTAI_PROTO_ALWAYS_INLINE(<span class="keywordtype">char</span> *, rtf_getfifobyminor,(<span class="keywordtype">int</span> minor, <span class="keywordtype">char</span> *buf, <span class="keywordtype">int</span> len))
00727 {
00728     snprintf(buf,len,CONFIG_RTAI_FIFOS_TEMPLATE,minor);
00729     <span class="keywordflow">return</span> buf;
00730 }
00731 
00732 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_getfifobyname,(<span class="keyword">const</span> <span class="keywordtype">char</span> *name))
00733 {
00734         <span class="keywordtype">int</span> fd, minor;
00735         <span class="keywordtype">char</span> nm[RTF_NAMELEN+1];
00736 
00737         <span class="keywordflow">if</span> (strlen(name) &gt; RTF_NAMELEN) {
00738                 <span class="keywordflow">return</span> -1;
00739         }
00740         <span class="keywordflow">if</span> ((fd = open(rtf_getfifobyminor(0,nm,<span class="keyword">sizeof</span>(nm)), O_RDONLY)) &lt; 0) {
00741                 <span class="keywordflow">return</span> -errno;
00742         }
00743         strncpy(nm, name, RTF_NAMELEN+1);
00744         minor = ioctl(fd, RTF_NAME_LOOKUP, nm);
00745         close(fd);
00746         <span class="keywordflow">return</span> minor &lt; 0 ? -errno : minor;
00747 }
00748 
00749 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_named_create,(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">int</span> size))
00750 {
00751         <span class="keywordtype">int</span> fd, minor;
00752         <span class="keywordtype">char</span> nm[RTF_NAMELEN+1];
00753 
00754         <span class="keywordflow">if</span> (strlen(name) &gt; RTF_NAMELEN) {
00755                 <span class="keywordflow">return</span> -1;
00756         }
00757         <span class="keywordflow">if</span> ((fd = open(rtf_getfifobyminor(0,nm,<span class="keyword">sizeof</span>(nm)), O_RDONLY)) &lt; 0) {
00758                 <span class="keywordflow">return</span> -errno;
00759         }
00760         strncpy(nm, name, RTF_NAMELEN+1);
00761         minor = ioctl(fd, RTF_NAMED_CREATE, nm, size);
00762         close(fd);
00763         <span class="keywordflow">return</span> minor &lt; 0 ? -errno : minor;
00764 }
00765 
00766 RTAI_PROTO(<span class="keywordtype">int</span>, rtf_create_named,(<span class="keyword">const</span> <span class="keywordtype">char</span> *name))
00767 {
00768         <span class="keywordtype">int</span> fd, minor;
00769         <span class="keywordtype">char</span> nm[RTF_NAMELEN+1];
00770 
00771         <span class="keywordflow">if</span> (strlen(name) &gt; RTF_NAMELEN) {
00772                 <span class="keywordflow">return</span> -1;
00773         }
00774         <span class="keywordflow">if</span> ((fd = open(rtf_getfifobyminor(0,nm,<span class="keyword">sizeof</span>(nm)), O_RDONLY)) &lt; 0) { 
00775                 <span class="keywordflow">return</span> -errno;
00776         }
00777         strncpy(nm, name, RTF_NAMELEN+1);
00778         minor = ioctl(fd, RTF_CREATE_NAMED, nm);
00779         close(fd);
00780         <span class="keywordflow">return</span> minor &lt; 0 ? -errno : minor;
00781 }
00782 
00783 <span class="preprocessor">#ifdef __cplusplus</span>
00784 <span class="preprocessor"></span>}
00785 <span class="preprocessor">#endif </span><span class="comment">/* __cplusplus */</span>
00786 
00787 <span class="preprocessor">#endif </span><span class="comment">/* __KERNEL__ */</span>
00788 
00789 <span class="preprocessor">#endif </span><span class="comment">/* !_RTAI_FIFOS_H */</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Jan 18 22:53:52 2005 for RTAI API by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
